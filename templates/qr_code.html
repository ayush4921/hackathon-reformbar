<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        #flexbox{
            display:flex;
            flex-direction:column;
        }
    </style>
</head> 
<body>

    <div id="flexbox"><h1 style="text-align:center;">Order {{drink_name}} By scanning your qrcode</h1>
    <div style="height: 100%;margin: auto;width: 60%;padding: 10px;"><div id="qr-reader" ></div></div>
    <div id="qr-reader-results"></div></div>
</body>
<script src="https://github.com/mebjas/html5-qrcode/releases/download/V2.0.11/html5-qrcode.min.js"></script>
<script>
    function docReady(fn) {
        // see if DOM is already available
        if (document.readyState === "complete"
            || document.readyState === "interactive") {
            setTimeout(fn, 1);
        } else {
            document.addEventListener("DOMContentLoaded", fn);
        }
    }

    docReady(function () {
        var resultContainer = document.getElementById('qr-reader-results');
        var lastResult, countResults = 0;
        function onScanSuccess(decodedText, decodedResult) {
            if (decodedText !== lastResult) {
                ++countResults;
                lastResult = decodedText;
                // Handle on success condition with the decoded message.
                console.log(`Scan result ${decodedText}`, decodedResult);
                var drink_id ='{{ data.drink_id }}';
                alert("Placing order for "+drink_id);
                $.ajax({
                    data: {
                        drink: drink_id,
                        id:decodedResult["decodedText"]
                    },
                    type: "POST",
                    url: "http://127.0.0.1:5000/add_drink",
                }).done(function (data) {
                    console.log("Request sent")
                    alert(data);
                });
                var elem = document.getElementById("qr-reader");
                elem.parentNode.removeChild(elem);        
            }}
        var html5QrcodeScanner = new Html5QrcodeScanner(
            "qr-reader", { fps: 10, qrbox: 250 });
            html5QrcodeScanner.render(onScanSuccess);
        });
</script>

</head>
</html>